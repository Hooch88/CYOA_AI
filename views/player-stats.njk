<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ² Player Stats Configuration</h1>
            <p>Configure your character's attributes and details</p>
            {% include "_navigation.njk" %}
        </div>

        <div class="config-content">
            <!-- Player Basic Info Section -->
            <div class="config-section">
                <h2>Basic Information</h2>
                <form id="player-stats-form" class="player-stats-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="player-name">Character Name</label>
                            <input type="text" 
                                   id="player-name" 
                                   name="name" 
                                   value="{{ player.name if player else '' }}" 
                                   placeholder="Enter character name" 
                                   required>
                            <span class="help-text">Your character's name as it appears in the game</span>
                        </div>

                        <div class="form-group">
                            <label for="player-level">Level</label>
                            <input type="number" 
                                   id="player-level" 
                                   name="level" 
                                   value="{{ player.level if player else 1 }}" 
                                   min="1" 
                                   required>
                            <span class="help-text">Character level (1-20)</span>
                        </div>

                        <div class="form-group full-width">
                            <label for="player-description">Description</label>
                            <textarea id="player-description" 
                                      name="description" 
                                      rows="3" 
                                      placeholder="Describe your character's appearance, personality, and background">{{ player.description if player else '' }}</textarea>
                            <span class="help-text">A detailed description of your character</span>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Health Section -->
            <div class="config-section">
                <h2>Health & Vitality</h2>
                <div class="form-grid">
                       <div class="form-group">
                           <label for="player-health">Current Health</label>
                           <input type="number"
                                  id="player-health"
                                  name="health"
                                  value="{{ player.health if player else 25 }}"
                                  min="0"
                                  max="999"
                                  form="player-stats-form">
                           <span class="help-text">Current hit points</span>
                       </div>

                        <div class="form-group">
                            <label>Maximum Health</label>
                            <div id="player-max-health-display" class="form-static-value">{{ player.maxHealth if player else 'Automatically calculated' }}</div>
                            <span class="help-text">Calculated automatically from level and health attribute.</span>
                        </div>
                </div>
            </div>

            <!-- Primary Attributes Section -->
            <div class="config-section">
                <h2>Primary Attributes</h2>
                <div class="attributes-grid">
                    {% set attributes = player.attributeInfo if player else {} %}
                    {% set defaultAttributes = [
                        { key: 'strength', label: 'Strength', abbr: 'STR', description: 'Physical power and muscle' },
                        { key: 'dexterity', label: 'Dexterity', abbr: 'DEX', description: 'Agility and reflexes' },
                        { key: 'constitution', label: 'Constitution', abbr: 'CON', description: 'Health and stamina' },
                        { key: 'intelligence', label: 'Intelligence', abbr: 'INT', description: 'Mental acuity and reasoning' },
                        { key: 'wisdom', label: 'Wisdom', abbr: 'WIS', description: 'Insight and perception' },
                        { key: 'charisma', label: 'Charisma', abbr: 'CHA', description: 'Charm and influence' }
                    ] %}

                    {% for attr in defaultAttributes %}
                    <div class="attribute-group">
                        <div class="attribute-header">
                            <label for="attr-{{ attr.key }}">{{ attr.label }}</label>
                            <span class="attribute-abbr">{{ attr.abbr }}</span>
                        </div>
                        <div class="attribute-input-group">
                            <input type="number" 
                                   id="attr-{{ attr.key }}" 
                                   name="attributes.{{ attr.key }}" 
                                   value="{{ attributes[attr.key].value if attributes[attr.key] else 10 }}" 
                                   min="3" 
                                   max="18" 
                                   form="player-stats-form"
                                   class="attribute-input">
                            <span class="attribute-modifier" data-attr="{{ attr.key }}">
                                +{{ ((attributes[attr.key].value if attributes[attr.key] else 10) - 10) // 2 }}
                            </span>
                        </div>
                        <span class="help-text">{{ attr.description }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {% if availableSkills and availableSkills|length %}
            <div class="config-section">
                <h2>Skills</h2>
                <div class="skill-pool">
                    <label for="unspent-skill-points-input">Unspent Skill Points</label>
                    <input type="number"
                           id="unspent-skill-points-input"
                           name="unspentSkillPoints"
                           value="{{ player.unspentSkillPoints if player else (availableSkills|length + 4) // 5 }}"
                           data-default="{{ player.unspentSkillPoints if player else (availableSkills|length + 4) // 5 }}"
                           min="0"
                           form="player-stats-form">
                    <span class="help-text">Allocate these as your character advances.</span>
                </div>
                <div class="skills-grid">
                    {% for skill in availableSkills %}
                    {% set skillValue = player.skills[skill.name] if player and player.skills and skill.name in player.skills else 1 %}
                    <div class="skill-card">
                        <div class="skill-header">
                            <label for="skill-{{ loop.index }}">{{ skill.name }}</label>
                            {% if skill.attribute %}<span class="skill-attribute">{{ skill.attribute }}</span>{% endif %}
                        </div>
                        <input type="number"
                               id="skill-{{ loop.index }}"
                               class="skill-input"
                               data-skill-name="{{ skill.name }}"
                               name="skills.{{ skill.name }}"
                               value="{{ skillValue }}"
                               min="0"
                               form="player-stats-form">
                        {% if skill.description %}
                        <span class="help-text">{{ skill.description }}</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="config-section" id="abilitiesSection">
                <h2>Abilities</h2>
                <div class="abilities-grid" id="abilitiesList">
                    {% if player and player.abilities %}
                        {% for ability in player.abilities %}
                            <div class="ability-card ability-type-{{ ability.type | default('Passive') | lower }}">
                                <div class="ability-header">
                                    <span class="ability-name">{{ ability.name }}</span>
                                    <span class="ability-meta">{{ ability.type | default('Passive') }}{% if ability.level %} â€¢ Level {{ ability.level }}{% endif %}</span>
                                </div>
                                {% if ability.description %}
                                <div class="ability-description">{{ ability.description }}</div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="abilities-empty" id="abilitiesEmpty" {% if player and player.abilities and player.abilities|length %}hidden{% endif %}>
                    No special abilities unlocked yet.
                </div>
            </div>

            <!-- Current Player Status -->
            {% if player %}
            <div class="config-section">
                <h2>Current Status</h2>
                <div class="status-display">
                    <div class="status-item">
                        <span class="status-label">Alive:</span>
                        <span class="status-value {{ 'alive' if player.alive else 'dead' }}">
                            {{ 'Yes' if player.alive else 'No' }}
                        </span>
                    </div>
                    {% set playerLocationId = player.locationId or player.currentLocation %}
                    {% if playerLocationId %}
                    <div class="status-item">
                        <span class="status-label">Location:</span>
                        <span class="status-value">{{ playerLocationId }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="submit" form="player-stats-form" class="btn btn-primary">
                    <span>ðŸ’¾</span> Save Character
                </button>
                {% if player %}
                <button type="button" id="reset-stats" class="btn btn-secondary">
                    <span>ðŸ”„</span> Reset to Defaults
                </button>
                {% endif %}
            </div>

            <!-- Status Message Area -->
            <div id="status-message" class="status-message" style="display: none;"></div>
        </div>
    </div>

    <script src="/js/image-manager.js"></script>
    <script src="/js/player-stats.js"></script>
</body>
</html>
